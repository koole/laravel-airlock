{"version":3,"file":"index.cjs.ts","sources":["../src/SanctumContext.tsx","../src/Sanctum.tsx","../src/withSanctum.tsx"],"sourcesContent":["import * as React from \"react\";\n\nexport interface ContextProps {\n  user: null | any;\n  authenticated: null | boolean;\n  signIn: (email: string, password: string, remember?: boolean) => Promise<{}>;\n  signOut: () => void;\n  setUser: (user: object, authenticated?: boolean) => void;\n  checkAuthentication: () => Promise<boolean>;\n}\n\nconst SanctumContext = React.createContext<Partial<ContextProps>>({});\n\nexport default SanctumContext;\n","import axios, { AxiosInstance } from \"axios\";\nimport * as React from \"react\";\nimport SanctumContext from \"./SanctumContext\";\n\naxios.defaults.withCredentials = true;\n\ninterface Props {\n  config: {\n    api_url: string;\n    axios_instance?: AxiosInstance;\n    csrf_cookie_route: string;\n    signin_route: string;\n    signout_route: string;\n    user_object_route: string;\n  };\n  checkOnInit?: boolean;\n}\n\ninterface State {\n  user: null | {};\n  authenticated: null | boolean;\n}\n\nclass Sanctum extends React.Component<Props, State> {\n  static defaultProps = {\n    checkOnInit: true,\n  };\n\n  axios: AxiosInstance;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      user: null,\n      authenticated: null,\n    };\n\n    this.axios = props.config.axios_instance || axios.create();\n    this.signIn = this.signIn.bind(this);\n    this.signOut = this.signOut.bind(this);\n    this.setUser = this.setUser.bind(this);\n    this.checkAuthentication = this.checkAuthentication.bind(this);\n  }\n\n  signIn(\n    email: string,\n    password: string,\n    remember: boolean = false\n  ): Promise<{}> {\n    const {\n      api_url,\n      csrf_cookie_route,\n      signin_route,\n      user_object_route,\n    } = this.props.config;\n\n    return new Promise(async (resolve, reject) => {\n      try {\n        // Get CSRF cookie.\n        await this.axios.get(`${api_url}/${csrf_cookie_route}`);\n        // Sign in.\n        await this.axios.post(`${api_url}/${signin_route}`, {\n          email,\n          password,\n          remember: remember ? true : null,\n        });\n        // When correct, get the user data.\n        const { data } = await this.axios.get(\n          `${api_url}/${user_object_route}`\n        );\n        this.setState({ user: data, authenticated: true });\n        return resolve(data);\n      } catch (error) {\n        return reject(error);\n      }\n    });\n  }\n\n  signOut() {\n    const { api_url, signout_route } = this.props.config;\n    return new Promise(async (resolve, reject) => {\n      try {\n        await this.axios.post(`${api_url}/${signout_route}`);\n        // Only sign out after the server has successfully responded.\n        this.setState({ user: null, authenticated: false });\n        resolve(undefined);\n      } catch (error) {\n        return reject(error);\n      }\n    });\n  }\n\n  setUser(user: object, authenticated: boolean = true) {\n    this.setState({ user, authenticated });\n  }\n\n  checkAuthentication(): Promise<boolean> {\n    const { api_url, user_object_route } = this.props.config;\n    return new Promise(async (resolve, reject) => {\n      if (this.state.authenticated === null) {\n        // The status is null if we haven't checked it, so we have to make a request.\n        try {\n          const { data } = await this.axios.get(\n            `${api_url}/${user_object_route}`\n          );\n          this.setState({ user: data, authenticated: true });\n          return resolve(true);\n        } catch (error) {\n          if (error.response && error.response.status === 401) {\n            // If there's a 401 error the user is not signed in.\n            this.setState({ user: null, authenticated: false });\n            return resolve(false);\n          } else {\n            // If there's any other error, something has gone wrong.\n            return reject(error);\n          }\n        }\n      } else {\n        // If it has been checked with the server before, we can just return the state.\n        return resolve(this.state.authenticated);\n      }\n    });\n  }\n\n  componentDidMount() {\n    if (this.props.checkOnInit) {\n      this.checkAuthentication();\n    }\n  }\n\n  render() {\n    return (\n      <SanctumContext.Provider\n        children={this.props.children || null}\n        value={{\n          user: this.state.user,\n          authenticated: this.state.authenticated,\n          signIn: this.signIn,\n          signOut: this.signOut,\n          setUser: this.setUser,\n          checkAuthentication: this.checkAuthentication,\n        }}\n      />\n    );\n  }\n}\n\nexport default Sanctum;\n","import * as React from \"react\";\nimport invariant from \"tiny-invariant\";\n\nimport SanctumContext from \"./SanctumContext\";\n\nconst withSanctum = (Component: React.ComponentType<any>) => {\n  const displayName = `withSanctum(${Component.displayName || Component.name})`;\n\n  const C = (props: any) => {\n    return (\n      <SanctumContext.Consumer>\n        {(context) => {\n          invariant(\n            context,\n            `You should not use <${displayName} /> outside a <Sanctum>`\n          );\n          return <Component {...props} {...context} />;\n        }}\n      </SanctumContext.Consumer>\n    );\n  };\n\n  C.displayName = displayName;\n\n  return C;\n};\n\nexport default withSanctum;\n"],"names":["React.createContext","axios","React.createElement","React.Component","invariant"],"mappings":"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"}